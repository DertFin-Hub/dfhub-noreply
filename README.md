# DFHub NoReply
**DFHub NoReply** - сервис DFHub, отвечающий за отправку электронных почтовых писем.

## Установка
Клонируйте репозиторий к себе на компьютер:
`git clone https://github.com/DertFin-Hub/dfhub-noreply.git`

Настройте `config.json`, указав следующие параметры:  
`public-address` - публичный адрес сервера, на который будут поступать запросы
`port` - порт сервера
`smtp-address`- адресс [SMTP](https://en.wikipedia.org/wiki/Simple_Mail_Transfer_Protocol)-сервера
`smtp-port` - порт SMTP-сервера. Обычно - `587`
`accessed-ips` - вайтлист адресов, с которых можно отправлять запросы на Ваш сервер
`is-ssl` - использует ли SMTP-сервер SSL *(по-стандарту false - используется TLS)*

`https.enables` - использовать ли SSL для DFHub-NoReply
`https.cert-file` - путь к `.pem` файлу с сертификатом
`https.key-file` - путь к приватному `.pem`-ключу от сертификата

Создайте файл `.env` в той же директории, что и сама программа и укажите следующие параметры:
```.env
DFHUB_NOREPLY_APP_MAIL=ваша_почта
DFHUB_NOREPLY_APP_TOKEN=пароль_вашего_приложения
```

ВАЖНО! `APP_TOKEN` - это не пароль от вашей почты, а пароль для авторизации приложений, который создается отдельно на
сервисе, через который создана почта *(обычно требует верификации)*

## Запуск

Скачайте Python:
`apt install python3 python3-pip -y`

Установите зависимости:
`pip install -r requirements.txt`

Запустите приложение:
`python3 main.py`

## Использование

Для проверки перейдите на главную страницу `/`. Если вы получили ошибку браузера, то приложение запущено неверно. 
Если вы получили ошибку сайта, то, вероятно, ваш IP не добавлен в `accessed_ips` в конфигурации. Если вы увидели *"DFHub-NoReply active"*, 
то приложение запущено успешно.

Все адреса, предназначенные для отправки сообщений работают только с методом `POST`. Для каждого из них нужен JSON с 
определенными параметрами, отличающимися в зависимости от требований.

### Send-Raw
`/api/v1/send-raw` - отправляет сообщение с сырым текстом. Вот список JSON-параметров, которые нужны для его отправки:

`to` - почта получателя
`subject` - тема сообщения
`context` - cодержимое сообщения

### Send-HTML
`/api/v1/send-html` - отправляет сообщение с текстом, который поддерживает форматирование в формате html.

Требует такие же параметры, что и `send-raw`

### Send-HTML-url
`/api/v1/send-html-url` - отправляет сообщение с текстом, который поддерживает форматирование в формате html. Текст не
передается в запросе, а достается по ссылке, указанной в нем. Для данного запроса нужны следующие параметры:

`to` - почта получателя
`subject` - тема сообщения
`attachment-url` - ссылка на ресурс с прикрепляемым контентом